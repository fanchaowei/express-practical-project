## 个人实战项目

本项目作为个人实战项目的后端，采用模块化设计，支持多子系统扩展。

### 注意事项
- **学习方法**: 参照 `learning-methods.md` 文档，该项目需遵循该学习方法
- **学习的注意事项**：生成注释时，对于一些基础的 js 语法就不用生成注释了，我是一名前端开发人员，对于 js 基础语法熟悉。
- **沟通语言**: 请用简体中文与我沟通
- 该项目为学习项目，无 worktree。

### 技术栈

- **后端框架**: Express.js
- **ORM**: Prisma
- **数据库**: PostgreSQL (Docker 部署)
- **架构模式**: 三层架构 (Controller - Service - Repository) + Model
- **鉴权方案**: JWT
- **图片存储**: 本地文件系统 (后续可扩展至云存储)

### 项目特点

- 模块化子系统设计，每个子系统对应一个独立的功能模块
- 预留多用户支持的扩展能力
- 统一的鉴权授权机制
- RESTful API 设计

### 功能规划

#### 1. 基础功能
- 用户认证系统（登录/登出）
- JWT 鉴权中间件
- 统一错误处理
- 请求日志记录

#### 2. 影片收藏子系统（首个子系统）
- **添加影片**: 支持电影/电视剧/番剧/动画电影
  - 上传多张图片（指定封面）
  - 记录评分、标签、上映年份、个人评语等信息
- **删除影片**: 删除已收藏的影片
- **筛选查询**: 按类型、评分、标签、年份等条件筛选

---

## 项目构建大纲

### 阶段一：项目初始化与环境搭建

**目标**: 搭建项目基础框架和开发环境

📖 **[查看详细文档](docs/plan/phase-1.md)**

1. **初始化 Node.js 项目**
   - 创建 package.json
   - 安装核心依赖 (express, prisma, typescript 等)
   - 配置 TypeScript (tsconfig.json)
   - 配置 ESLint 和 Prettier

2. **Docker 环境配置**
   - 编写 docker-compose.yml
   - 配置 PostgreSQL 容器
   - 配置环境变量 (.env)

3. **Prisma 初始化**
   - 初始化 Prisma
   - 配置数据库连接
   - 测试数据库连接

### 阶段二：项目架构搭建 ✅

**目标**: 建立清晰的项目目录结构和代码组织方式

**状态**: 已完成

📖 **[设计文档](docs/plan/phase-2.md)**
📋 **[实施计划](docs/plans/2026-02-15-project-architecture-setup.md)**
📚 **[架构文档](docs/architecture.md)**

1. **创建三层架构目录结构**
   - `/src/controllers` - 控制器层
   - `/src/services` - 业务逻辑层
   - `/src/repositories` - 数据访问层
   - `/src/models` - Prisma 模型
   - `/src/middlewares` - 中间件
   - `/src/routes` - 路由定义
   - `/src/utils` - 工具函数
   - `/src/config` - 配置文件

2. **搭建基础设施代码**
   - Express 应用初始化
   - 全局中间件配置 (cors, body-parser, 日志等)
   - 统一错误处理机制
   - 统一响应格式封装

### 阶段三：用户认证系统 ✅

**目标**: 实现基础的用户登录和 JWT 鉴权

**状态**: 已完成

📖 **[设计文档](docs/plan/phase-3.md)**
📋 **[实施计划](docs/plans/2026-02-21-phase3-user-authentication.md)**

1. **数据库设计**
   - 设计 User 表结构
   - 编写 Prisma Schema

2. **认证功能实现**
   - 用户登录接口 (POST /api/v1/auth/login)
   - 密码加密 (bcrypt)
   - JWT 生成与验证
   - 鉴权中间件开发

3. **初始化管理员账户**
   - 创建数据库迁移
   - 编写种子数据脚本

### 阶段四：影片收藏子系统

📖 **[设计文档](docs/plan/phase-4.md)**

**目标**: 实现第一个业务子系统

1. **数据库设计**
   - 设计影片相关表结构 (Movie, Image, Tag 等)
   - 定义表关系 (一对多、多对多)
   - 预留用户关联字段 (为多用户扩展做准备)

2. **图片上传功能**
   - 配置文件上传中间件 (multer)
   - 实现图片存储逻辑
   - 图片访问静态路由

3. **影片 CRUD 接口**
   - 添加影片 (POST)
   - 查询影片列表 (GET + 筛选/分页)
   - 查询影片详情 (GET)
   - 更新影片信息 (PUT)
   - 删除影片 (DELETE)

4. **高级查询功能**
   - 多条件筛选
   - 分页处理
   - 排序功能

### 阶段五：测试与优化

**目标**: 确保代码质量和性能

1. **接口测试**
   - 使用 Postman/Thunder Client 测试所有接口
   - 编写接口文档

2. **代码优化**
   - 数据库查询优化
   - 添加必要的索引
   - 错误处理完善

3. **安全加固**
   - 输入验证 (使用 joi 或 zod)
   - SQL 注入防护 (Prisma 自带)
   - XSS 防护
   - 请求频率限制

### 阶段六：部署准备

**目标**: 为生产环境部署做准备

1. **环境配置**
   - 区分开发/生产环境配置
   - 环境变量管理

2. **构建脚本**
   - TypeScript 编译配置
   - 启动脚本编写

3. **文档完善**
   - API 文档
   - 部署文档
   - 开发文档

### 阶段七：多用户扩展（后期）

**目标**: 支持多用户注册和使用

1. **用户系统扩展**
   - 用户注册接口
   - 用户信息管理
   - 权限系统设计

2. **数据隔离**
   - 影片数据与用户关联
   - 查询接口添加用户过滤

3. **权限控制**
   - 基于角色的访问控制 (RBAC)
   - 资源所有权验证

---

## 开发建议

### 开发顺序
建议按照上述阶段顺序逐步开发，每完成一个阶段进行测试验证后再进入下一阶段。

### 版本控制
- 每完成一个功能模块提交一次 Git
- 使用有意义的 commit message
- 重要节点打 tag

### 学习资源
- Express 官方文档
- Prisma 官方文档
- PostgreSQL 文档
- JWT 最佳实践

### 注意事项
- 敏感信息不要提交到 Git (.env 文件)
- 定期备份数据库
- 开发过程中保持代码整洁
- 遵循 RESTful API 设计规范


